# ÔøΩ Mastercard Priceless 2X1 - Promociones 2X1 y Descuentos

> Portal B2C Mastercard con promociones exclusivas: 2X1 o Descuentos en productos de viaje. Modelo 100% dinero con 7 escenarios de pago/emisi√≥n.

---

## üìã Informaci√≥n General

| Campo | Valor |
|-------|-------|
| **Portal Test** | https://test-skynet-pmc.smartlinks.dev/es-co |
| **Portal Demo** | https://demo-skynet-pmc.smartlinks.dev/es-co |
| **Portal Producci√≥n** | https://vuelaconoccidente.com/es-co |
| **Cliente** | Mastercard (sub-proyecto Priceless 2X1) |
| **Pa√≠s** | Colombia |
| **Moneda** | COP (Pesos Colombianos) |
| **Modelo de Negocio** | B2C (Business to Consumer) |
| **Plataforma** | Priceless 2X1 |
| **C√©lula** | Skynet |
| **Prefijo** | [Priceless] |
| **Agente QA** | PRICELESS_QA_Assistant |

---

## ‚ö†Ô∏è Diferencia Cr√≠tica: Priceless 2X1 vs MRS

**Ambos son proyectos de Mastercard pero COMPLETAMENTE DIFERENTES:**

| Aspecto | Priceless 2X1 | MRS |
|---------|---------------|-----|
| **Modelo** | B2C, 100% Dinero (COP) | B2B2C, Slider (Millas + Plata) |
| **Promoci√≥n** | 2X1 o Descuento | Redenci√≥n con puntos |
| **Pa√≠s** | Colombia | Ecuador, Honduras, Guatemala, Panam√°, Nicaragua, Costa Rica |
| **Dispersi√≥n** | Condicional (7 escenarios) | No aplica |
| **Fee Oculto** | S√≠ (en algunos escenarios) | S√≠ |
| **Pasarela** | PlacetoPay | [MRS y PlacetoPay] |
| **Prefijo** | [Priceless] | [MRS] |
| **Agente** | PRICELESS_QA_Assistant | MRS_QA_Assistant |

---

## üí∞ Modelo de Negocio - Promociones 2X1 y Descuentos

### üéÅ Dos Tipos de Promociones

**1. Promoci√≥n 2X1 (Dos por Uno)**
```
Concepto:  Cliente paga 1 producto y obtiene 2
Pago:      100% DINERO (COP)
Emisi√≥n:   VARIABLE (seg√∫n escenario 1-7)
Tarjeta:   PlacetoPay (P2P)
C√°lculo:   (Base + Taxes) √ó 1 PAX + (Fee Transaccional √ó 2)
```

**Caracter√≠sticas:**
- ‚úÖ Cliente paga solo 1 tiquete
- ‚úÖ Fee transaccional se cobra por 2 pasajeros ($20,000 COP)
- ‚úÖ Obtiene 2 productos/tiquetes
- ‚úÖ Sin descuento visible, simplemente se cobra 1

**2. Promoci√≥n Descuento**
```
Concepto:  Cliente paga 2 productos con descuento aplicado
Pago:      100% DINERO (COP)
Emisi√≥n:   VARIABLE (seg√∫n escenario 1-7)
Tarjeta:   PlacetoPay (P2P)
C√°lculo:   [(Base + Taxes) √ó 2 PAX - Descuento] + (Fee Transaccional √ó 2)
```

**Caracter√≠sticas:**
- ‚úÖ Cliente paga 2 productos
- ‚úÖ Descuento aplicado al total (fijo o porcentaje)
- ‚úÖ Fee transaccional se cobra por 2 pasajeros ($20,000 COP)
- ‚úÖ Descuento visible claramente al usuario

### üí≥ Componentes del Precio

| Componente | Valor | Visibilidad |
|------------|-------|-------------|
| **Fee Transaccional** | $10,000 COP/pasajero | ‚úÖ Visible |
| **Fee Oculto (HF)** | Variable (seg√∫n tarifa) | ‚ùå NO visible |
| **Base + Taxes** | Variable (del proveedor) | ‚úÖ Visible |
| **Descuento** | Fijo o % (seg√∫n campa√±a) | ‚úÖ Visible (si aplica) |

---

## üîÑ 7 Escenarios de Pago y Emisi√≥n

**Priceless 2X1 es el √öNICO modelo con 7 escenarios diferentes de pago/emisi√≥n.**

### Escenario 1: Edifact - 2X1 SIN fee oculto + Dispersi√≥n ACTIVA
```
Pago:     TC Cliente (1 PQ + Fee) + TC Corporativa (1 PQ)
Emisi√≥n:  1er tiquete TC Cliente, 2do tiquete TC Corporativa
```

### Escenario 2: Edifact - 2X1 SIN fee oculto + Dispersi√≥n INACTIVA
```
Pago:     TC Cliente (total)
Emisi√≥n:  2 tiquetes CASH
```

### Escenario 3: 2X1 o Descuento CON fee oculto + Dispersi√≥n ACTIVA
```
Pago:     TC Cliente (total) + TC Corporativa (2 PQ)
Emisi√≥n:  2 tiquetes TC Corporativa
```

### Escenario 4: 2X1 o Descuento CON fee oculto + Dispersi√≥n INACTIVA
```
Pago:     TC Cliente (total)
Emisi√≥n:  2 tiquetes CASH
```

### Escenario 5: Edifact - Descuento SIN fee oculto + Dispersi√≥n ACTIVA
```
Pago:     TC Cliente (total con dispersi√≥n)
Emisi√≥n:  1er tiquete TC Cliente, 2do tiquete CASH + TC Cliente
```

### Escenario 6: Edifact - Descuento SIN fee oculto + Dispersi√≥n INACTIVA
```
Pago:     TC Cliente (total)
Emisi√≥n:  2 tiquetes CASH
```

### Escenario 7: Aggregator (Sabre NDC o Netatica)
```
Pago:     TC Cliente (total)
Emisi√≥n:  2 tiquetes CASH
```

### üìä Tabla Resumen Escenarios

| Escenario | Promoci√≥n | Fee Oculto | Dispersi√≥n | Pago TC Cliente | Pago TC Corporativa | Emisi√≥n 1er | Emisi√≥n 2do |
|-----------|-----------|------------|------------|-----------------|---------------------|-------------|-------------|
| **1** | 2X1 | NO | S√ç | 1 PQ + Fee | 1 PQ | TC Cliente | TC Corporativa |
| **2** | 2X1 | NO | NO | Total | - | Cash | Cash |
| **3** | 2X1/Desc | S√ç | S√ç | Total | 2 PQ | TC Corporativa | TC Corporativa |
| **4** | 2X1/Desc | S√ç | NO | Total | - | Cash | Cash |
| **5** | Descuento | NO | S√ç | Total | - | TC Cliente | Cash + TC Cliente |
| **6** | Descuento | NO | NO | Total | - | Cash | Cash |
| **7** | Cualquiera | - | NO (Aggregator) | Total | - | Cash | Cash |

---

## üó∫Ô∏è Flujo E2E Completo

### Pantallas del Proceso (Todas las Transacciones)

```mermaid
graph LR
    A[Login] --> B[Home]
    B --> C[Disponibilidad]
    C --> D[Upsell]
    D --> E[Resumen]
    E --> F[Checkout]
    F --> G[Confirmaci√≥n]
    G --> H[Admin Validaci√≥n]
```

**Descripci√≥n del Flujo:**

1. **Login**
   - Usuario ingresa credenciales o usa **SSO (Single Sign-On)**
   - **Autenticaci√≥n SSO:** Token generado via `security/api/saml/acs` (vigencia 24h)
   - Tipos de usuario: **001 ‚Äì Good Standing** (recomendado para testing)
   - Autenticaci√≥n en MRS (Austro/Ficohsa/Coopenae)
   - Acceso a portal del cliente correspondiente
   - üìã [Ver detalle autenticaci√≥n SSO](../../../shared/Reglas%20Marketplace/MRS_COMMON_RULES.md#-autenticaci√≥n-sso-single-sign-on)

2. **Home**
   - Pantalla inicial de b√∫squeda
   - Usuario selecciona producto (Vuelos, Hoteles, Autos, Actividades, Disney)
   - Ingresa criterios de b√∫squeda

3. **Disponibilidad**
   - Resultados de b√∫squeda
   - **Slider de Millas + Plata visible**
   - Usuario ajusta % de millas vs plata
   - Selecci√≥n de opci√≥n

4. **Upsell**
   - Ofertas adicionales
   - Upgrades disponibles
   - Seguros, servicios extra

5. **Resumen**
   - Detalle completo de la selecci√≥n
   - Resumen de costos
   - **Confirmaci√≥n de slider:** Millas + Plata
   - Revisi√≥n antes de checkout

6. **Checkout**
   - Datos del pasajero/usuario
   - **Confirmaci√≥n final de slider**
   - Datos de tarjeta (si es Millas + Plata)
   - T√©rminos y condiciones

7. **Confirmaci√≥n**
   - C√≥digo de reserva
   - Resumen de pago:
     - **Solo Millas:** Millas debitadas
     - **Millas + Plata:** Millas debitadas + Monto USD
   - Instrucciones siguientes pasos

8. **Admin - Validaci√≥n de Reservas**
   - Ingreso al administrador MRS del cliente correspondiente
   - B√∫squeda por c√≥digo de reserva
   - Validaciones:
     - **Solo Millas (100%):** Estado EMITIDA autom√°ticamente ‚úÖ
     - **Millas + Plata:** Estado EMITIDA autom√°ticamente ‚úÖ

---

## ÔøΩüîÑ Proceso de Emisi√≥n

### ‚úÖ Emisi√≥n Autom√°tica (Solo Millas)

```mermaid
graph LR
    A[Checkout] --> B[D√©bito Millas]
    B --> C[Emisi√≥n Autom√°tica]
    C --> D[Estado: EMITIDA]
```

**Caracter√≠sticas:**
- ‚úÖ Sin intervenci√≥n manual
- ‚úÖ Estado EMITIDA inmediato
- ‚úÖ Usuario recibe confirmaci√≥n al instante

### üîß Emisi√≥n Autom√°tica (Millas + Plata)

```mermaid
graph LR
    A[Checkout] --> B[D√©bito Millas + Cobro Tarjeta]
    B --> C[Emisi√≥n Autom√°tica]
    C --> D[Estado: EMITIDA]
```

**Caracter√≠sticas:**
- ‚úÖ Sin intervenci√≥n manual
- ‚úÖ Estado EMITIDA inmediato
- ‚úÖ Usuario recibe confirmaci√≥n al instante
- ‚úÖ D√©bito de millas y cobro en tarjeta procesados autom√°ticamente

---

## üì¶ Productos y Proveedores

### üõ´ Vuelos
- **Framework:** Angular
- **Proveedores:**
  - SABRE (directo - Edifact)
  - AGGREGATOR NETATICA
  - AGGREGATOR SABRE NDC
- **Dispersi√≥n:** Condicional (seg√∫n aerol√≠nea)
- **Fee Transaccional:** $10,000 COP por pasajero

### üè® Hoteles
- **Framework:** Angular
- **Proveedor:** SABRE
- **Dispersi√≥n:** Condicional (seg√∫n hotel)
- **Fee Transaccional:** $10,000 COP por pasajero

### üöó Autos
- **Framework:** React
- **Proveedores:**
  - Hertz (global)
  - Thermeon (solo M√©xico)
- **Dispersi√≥n:** Condicional
- **Fee Transaccional:** $10,000 COP por pasajero

---

## ‚úÖ Validaciones Cr√≠ticas

### Promociones
- ‚úÖ Tipo de promoci√≥n visible (2X1 o Descuento)
- ‚úÖ C√°lculo correcto seg√∫n f√≥rmula oficial
- ‚úÖ Fee transaccional = $10,000 COP por pasajero ($20,000 total)
- ‚úÖ Fee oculto NO visible al usuario
- ‚úÖ Descuento aplicado correctamente (si aplica)

### Aeropuertos Permitidos
- ‚úÖ Solo aeropuertos en collection allowedAirports
- ‚úÖ B√∫squeda bloqueada para aeropuertos no permitidos
- ‚úÖ Mensaje de error claro si ruta no habilitada

### Checkout y Pago
- ‚úÖ Campos obligatorios completos
- ‚úÖ Redirecci√≥n a PlacetoPay correcta
- ‚úÖ Tarjeta de cr√©dito requerida (PlacetoPay)
- ‚úÖ T√©rminos y condiciones aceptados
- ‚úÖ Precio final coincide con resumen
- ‚úÖ Escenario de pago correcto (1-7)

### Confirmaci√≥n
- ‚úÖ C√≥digo de reserva visible
- ‚úÖ Total cobrado en COP correcto
- ‚úÖ Valores consistentes con checkout
- ‚úÖ Promoci√≥n aplicada visible
- ‚úÖ Fee transaccional desglosado

### Admin Priceless
- ‚úÖ Reserva localizable por c√≥digo
- ‚úÖ Estado EMITIDA seg√∫n escenario (1-7)
- ‚úÖ M√©todo de emisi√≥n correcto:
  - TC Cliente (escenarios 1, 5)
  - TC Corporativa (escenario 3)
  - CASH (escenarios 2, 4, 6, 7)
  - Mixto (escenario 5)
- ‚úÖ Dispersi√≥n ejecutada (si aplica)
- ‚úÖ Fee oculto cubierto (si aplica)

---

## üîÑ Proceso de Cancelaci√≥n

### Cancelar Reserva EMITIDA

**Estado inicial:** EMITIDA (seg√∫n escenario 1-7)

**Pasos:**
1. Ingresar al admin Priceless (Skynet)
2. Buscar reserva por c√≥digo
3. Click en "Cancelar" (seg√∫n pol√≠ticas del producto)
4. Confirmar cancelaci√≥n
5. Sistema ejecuta reverso seg√∫n escenario:
   - **TC Cliente:** Reverso autom√°tico
   - **TC Corporativa:** Proceso manual de reverso
   - **CASH:** Gesti√≥n manual con aerol√≠nea/proveedor
6. Estado final: CANCELADO

**Validaciones:**
- ‚úÖ Reserva estaba EMITIDA
- ‚úÖ Reverso procesado correctamente
- ‚úÖ Estado actualizado a CANCELADO
- ‚úÖ Fee transaccional reembolsado (seg√∫n pol√≠ticas)

---

## üìä Matriz de Estados por Escenario

| Escenario | Pago | Emisi√≥n | Cancelaci√≥n |
|-----------|------|---------|-------------|
| **1** | TC Cliente + TC Corp | TC Cliente + TC Corp | Reverso mixto |
| **2** | TC Cliente | CASH | Reverso TC + Gesti√≥n manual |
| **3** | TC Cliente + TC Corp | TC Corporativa | Reverso mixto |
| **4** | TC Cliente | CASH | Reverso TC + Gesti√≥n manual |
| **5** | TC Cliente | TC Cliente + CASH | Reverso mixto |
| **6** | TC Cliente | CASH | Reverso TC + Gesti√≥n manual |
| **7** | TC Cliente | CASH | Reverso TC + Gesti√≥n manual |

---

## üéØ Diferencias Clave vs MRS (Mastercard Rewards System)

| Aspecto | Priceless 2X1 | MRS |
|---------|---------------|-----|
| **Modelo** | 100% Dinero (COP) | Slider Millas + Plata |
| **Promoci√≥n** | 2X1 o Descuento | Redenci√≥n con puntos |
| **Escenarios** | 7 diferentes | 2 (solo millas o mixto) |
| **Fee Transaccional** | ‚úÖ $10,000/PAX | ‚ùå No |
| **Fee Oculto** | ‚úÖ S√≠ (variable) | ‚ùå No |
| **Dispersi√≥n** | Condicional | No aplica |
| **TC Corporativa** | ‚úÖ S√≠ (algunos escenarios) | ‚ùå No |
| **Pa√≠s** | Colombia | 6 pa√≠ses diferentes |
| **Pasarela** | PlacetoPay | [Otra] |
| **Complejidad QA** | üî¥ ALTA | üü° MEDIA |
| **Emisi√≥n** | Variable (7 modos) | Autom√°tica |
| **allowedAirports** | ‚úÖ S√≠ (manual) | ‚ùå No |

---

## üìö Documentaci√≥n de Referencia

**Reglas de Negocio:**
- [PRICELESS_COMMON_RULES.md](../../../shared/Reglas%20Marketplace/PRICELESS_COMMON_RULES.md) - Reglas comunes Priceless 2X1
- [7 Escenarios de Pago/Emisi√≥n](../../../shared/Reglas%20Marketplace/PRICELESS_COMMON_RULES.md#üîÑ-escenarios-de-pago-y-emisi√≥n)
- [F√≥rmulas de C√°lculo](../../../shared/Reglas%20Marketplace/PRICELESS_COMMON_RULES.md#üßÆ-reglas-de-c√°lculo-promociones-2x1-y-descuento)

**Flujos por Producto:**
- [PRICELESS_VUELOS.md](PRICELESS_VUELOS.md) - Flujo E2E Vuelos (Pendiente crear)
- [PRICELESS_HOTELES.md](PRICELESS_HOTELES.md) - Flujo E2E Hoteles (Pendiente crear)
- [PRICELESS_AUTOS.md](PRICELESS_AUTOS.md) - Flujo E2E Autos (Pendiente crear)

**Documentaci√≥n Complementaria:**
- [Wiki: Mastercard - Priceless 2X1](https://dev.azure.com/ultragrouplaorg/ultragroupla/_wiki/wikis/Ultra%20Group%20Wiki/1141/Mastercard-Priceless-2X1)
- [Excel: Calcular 2x1 o descuento.xlsx](https://smartlinksdev-my.sharepoint.com/:x:/r/personal/crubiog_ultragroupla_com/_layouts/15/Doc.aspx?sourcedoc=%7B64CBE898-E0F2-402B-88AB-1093813C7C49%7D&file=Calcular%202x1%20o%20descuento.xlsx) - F√≥rmulas oficiales

**Agente QA:**
- [PRICELESS_QA_Assistant](../../../agents/PRICELESS_QA_Assistant.agent.md) - Agente especializado Priceless 2X1

---

## üöÄ Testing

**Complejidad:** üî¥ ALTA

**Razones:**
- 7 escenarios diferentes de pago/emisi√≥n
- Variables combinables: Promoci√≥n + Fee Oculto + Dispersi√≥n + Proveedor
- Uso dual de tarjetas (TC Cliente + TC Corporativa)
- Emisi√≥n mixta (TC Cliente, TC Corporativa, CASH, combinaciones)
- F√≥rmulas de c√°lculo espec√≠ficas para cada tipo de promoci√≥n
- Aeropuertos restringidos (allowedAirports)
- Dispersi√≥n condicional por aerol√≠nea
- Fee oculto variable y no visible

**Casos Cr√≠ticos:**
1. Validar c√°lculo 2X1 (cliente paga 1, obtiene 2)
2. Validar c√°lculo Descuento (descuento sobre 2 PAX)
3. Probar cada uno de los 7 escenarios de pago/emisi√≥n
4. Verificar dispersi√≥n activa vs inactiva
5. Validar fee oculto NO visible al usuario
6. Probar TC Corporativa (escenarios 1, 3, 5)
7. Validar aeropuertos en allowedAirports
8. Verificar PlacetoPay integraci√≥n correcta
9. Probar todos los proveedores (SABRE, Netatica, Sabre NDC, Hertz, Thermeon)
10. Validar cada tipo de emisi√≥n (TC Cliente, TC Corporativa, CASH, Mixta)

---

## üìû Contacto

**Agente QA:** PRICELESS_QA_Assistant  
**Ubicaci√≥n:** `.github/agents/PRICELESS_QA_Assistant.agent.md`

**Para:**
- Crear casos de prueba Priceless 2X1
- An√°lisis de HU Priceless
- Consultas t√©cnicas Priceless
- Trabajo con portal vuelaconoccidente.com

---

**√öltima actualizaci√≥n:** 2026-02-03  
**Versi√≥n:** 1.0  
**Estado:** ‚úÖ Activo

